function downloadNotecardNR(e){return new Promise(function(t,n){ajaxReturningXML("GET","public/notecards/"+e).then(function(e){t(e)}).catch(function(e){n(e)})})}function getPublicNotecardDetailsNR(e,t){return new Promise(function(n,r){authenticatedAjaxWithoutData("GET","public/notecards/"+e+"/details",t).then(function(e){n(e)}).catch(function(e){r(e)})})}function getAccountsStatus(){return new Promise(function(e,t){ajaxWithoutData("GET","userprofile/accounts/status",!0).then(function(t){e(t)}).catch(function(e){t(e)})})}function ajaxReturningXML(e,t){return new Promise(function(n,r){var o=new XMLHttpRequest;o.onload=function(){null===this.responseXML?n(jQuery.parseJSON(this.response)):n(this.responseXML)},o.onerror=r,o.open(e,prependAPIPrefix(t)),o.setRequestHeader("dataType","xml"),o.send()})}function ajaxWithoutData(e,t,n){return new Promise(function(r,o){var i=new XMLHttpRequest;i.onload=function(){r(this.responseText)},i.onerror=o,i.open(e,prependAPIPrefix(t)),n&&i.setRequestHeader("X-ZCSRF-TOKEN",getznbcsr()),i.send()})}function authenticatedAjaxWithoutData(e,t,n){return new Promise(function(r,o){var i=new XMLHttpRequest;i.onload=function(){r(this.responseText)},i.onerror=o,i.open(e,prependAPIPrefix(t),n),i.setRequestHeader("X-ZCSRF-TOKEN",getznbcsr()),i.send()})}function prependAPIPrefix(e){return"https://"+document.domain+"/api/v1/"+e}function loadCSS(e,t,n){var r=document.createElement("link");r.rel="stylesheet",r.href=e,t&&(r.class=t),n&&(r.charset=n),document.head.appendChild(r)}function filePreview(e,t){return new Promise(function(n,r){var o=new XMLHttpRequest;o.onload=function(){4==o.readyState&&n(this.responseText)},o.withCredetials=!0,o.onerror=r,o.open(e,t),o.send()})}function downloadNoteSmartContentNR(e){return new Promise(function(t,n){ajaxWithoutData("GET","public/notecards/"+e+"/smart?content=true").then(function(e){t(e)}).catch(function(e){n(e)})})}function getznbcsr(){for(var e=document.cookie.split(";"),t=0;t<e.length;t++){for(var n=e[t];" "===n.charAt(0);)n=n.substring(1);var r=n.split("=");if("znbcsr"===r[0]){var o=r[1].length>0?r[1]:"";return"znbrcsr="+o}}return""}function getDocsDomain(e){var t=document.domain;return isValidObject(e)&&isValidObject(e.embed_resources[0])?1===e.embed_resources[0].docs_domain?-1!==t.indexOf(".localzoho")?"https://docs.localzoho.com":"https://"+t.replace("notebook.zohopublic","docs.zoho"):-1!==t.indexOf(".localzoho")?"https://workdrive.localzoho.com":"https://"+t.replace("notebook.zohopublic","workdrive.zoho"):"https://docs.zoho.com"}function getExternalFileUrlForWD(){var e=document.domain,t="workdrive.zohoexternal";return e?-1!==e.indexOf(".localzoho")?"https://"+(t="workdrive.localzohoexternal")+".com":"https://"+e.replace("notebook.zohopublic",t):"https://workdrive.zohoexternal.com"}function getZohoDomain(){var e=document.domain;return e&&-1!==e.indexOf("notebook")?"https://"+e.replace("notebook","www"):"https://www.zoho.com"}function ajaxWithData(e,t,n){return new Promise(function(r,o){var i=new XMLHttpRequest;i.onload=function(){r(this.responseText)},i.onerror=o,i.open(e,prependAPIPrefix(t)),i.setRequestHeader("X-ZCSRF-TOKEN",getznbcsr()),i.setRequestHeader("timeout",3e4),i.setRequestHeader("dataType","json"),"PUT"===e&&(i.setRequestHeader("processData",!1),i.setRequestHeader("contentType",!1),i.setRequestHeader("cache",!1)),i.send(n)})}function reportAbuseNR(e){return new Promise(function(t,n){ajaxWithData("POST","feedback/abuse",e).then(function(e){t(e)}).catch(function(e){n(e)})})}function getPreviewEngineUrl(e){isUSLiveDomain=document.domain.endsWith(".com")&&document.domain.includes(".zoho");let t=document.domain.replace("notebook",isUSLiveDomain?"previewengine-accl":"previewengine");return"https://"+(t=t.replace("public","external"))+"/video/WD/"+e+"/hls_manifest"}Lyte.Router.configureDefaults({baseURL:"",history:"html5"}),Lyte.Router.configureRoutes(function(){this.route("index",{path:"/"},function(){this.route("notecards",{path:"public/notes/:notecard_id"}),this.route("faq",{path:"/faq"}),this.route("whats-new",{path:"/whats-new"}),this.route("msteams",{path:"public/msteams"})})}),Lyte.Component.registerHelper("set-value",function(setvalue){return setvalue=eval(setvalue),setvalue}),Lyte.Component.registerHelper("empty",function(e){return!!e}),Lyte.Component.registerHelper("background-color-style",function(){var e=arguments[0],t="",n=arguments[1],r=arguments[2],o=arguments[3];if(isValidObject(r)){if(isValidObject(o)){let e=hexToRgb(r);return"background-color: rgba("+e.r+", "+e.g+", "+e.b+", "+o+"); color: "+getTextColor(r)+";"}return"background-color: "+r+"; color: "+getTextColor(r)+";"}if(isValidObject(n)){if(isValidObject(o)){let e=hexToRgb(n);return"background-color: rgba("+e.r+", "+e.g+", "+e.b+", "+o+"); color: "+getTextColor(n)+";"}return"background-color: "+n+"; color: "+getTextColor(n)+";"}if(void 0!==e){if(t="#ffffff"===e||"#fff"===e?"#212121":getTextColor(e),isValidObject(o)){let n=hexToRgb(e);return"background-color: rgba("+n.r+", "+n.g+", "+n.b+", "+o+"); color: "+t+";"}return"background-color: "+e+"; color: "+t+";"}return""}),Lyte.Component.registerHelper("operator",function(e,t,n){switch(t){case"&&":return e&&n;case"||":return e||n;case">":return e>n;case"===":return e===n;case"!==":return e!==n;case"!":return!e}return!1}),Lyte.Component.registerHelper("replace-with-if-empty",function(){if(arguments[0]=ZSEC.Encoder.encodeForHTML(arguments[0]),arguments[1]=ZSEC.Encoder.encodeForHTML(arguments[1]),isValidObject(arguments[0])){if(arguments.length>2)for(let e=2;e<arguments.length;e++)if(arguments[0].toLowerCase()===arguments[e].toLowerCase())return arguments[1];return arguments[0]}return arguments[1]}),Lyte.Component.registerHelper("translate",function(e){if(!isValidString(e))return translate.error;for(var t=translate,n=e.split("."),r=0;r<n.length;r++)t=t[n[r]];return t}),Lyte.Component.registerHelper("background-image-style",function(){var e=arguments[0];return isValidObject(e)?"background-image: url('"+e+"')":""}),Lyte.Component.registerHelper("format-date",function(){var e=arguments[0];if("number"==typeof e&&(e=getDateInUTC(e)),isValidObject(e)){var t=getDateFromUTCTime(e),n=t.getDate();n=n>9?n:"0"+n;var r=t.getMonth(),o=t.getFullYear(),i=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"][r];t.getHours(),t.getMinutes();var a=new Date;switch(a.setHours(0,0,0,0),arguments[1]){case"notecard_grid":var s=t.getTime(),l=a.getTime(),c=new Date;c.setHours(0,0,0,0),c.setDate(a.getDate()-1);var d=c.getTime();return s>=l?"Today":s>=d&&s<l?"Yesterday":o===a.getFullYear()?i+" "+n:i+" "+n+", "+o;case"dd MMM, yyyy":return n+" "+i+", "+o;default:return n+" "+i+" "+o}}return""}),Lyte.Router.registerRoute("index",{queryParams:["version","platform"],getResources:function(e){},getDependencies:function(e){},beforeModel:function(e){var t=calculateLocale();-1===t.indexOf("en-us")&&Lyte.injectResources("/public/mixins/locales/"+t+"/translation.js")},model:function(e){return{}},afterModel:function(e,t){},redirect:function(e,t){},renderTemplate:function(e,t){},afterRender:function(e,t){loadCSS("https://fonts.googleapis.com/css?family=Lato:400,700")},actions:{willTransition:function(){},didTransition:function(){}},beforeExit:function(e,t){}}),Lyte.Router.registerRoute("index.faq",{queryParams:["version"],getResources:function(){return["/public/consolidated_files/faq.js"]},getDependencies:function(){},beforeModel:function(e){},model:function(e){},afterModel:function(e,t){},redirect:function(){},renderTemplate:function(e,t){return{outlet:"#outlet",component:"faq-comp"}},afterRender:function(e,t){},actions:{onError:function(e,t,n,r){},willTransition:function(){},didTransition:function(){}},beforeExit:function(){}}),Lyte.Router.registerRoute("index.whats-new",{queryParams:["version","platform"],getResources:function(){return["/public/consolidated_files/whatsnew.js"]},getDependencies:function(){return["public/data_content/whatsnew_data.js"]},beforeModel:function(e){},model:function(e){var t=e.queryParams.version,n=e.queryParams.platform;if(isValidString(t)&&"all"!==t){isValidObject(window["version"+t.replace(/\./g,"_")])||(t=finalSlicedVersion(t));var r=window["version"+t.replace(/\./g,"_")];n="default",isValidObject(r[e.queryParams.platform])&&(n=e.queryParams.platform),isValidObject(r[n].features)?translate=window["version"+t.replace(/\./g,"_")][n]:(t=finalSlicedVersion(t),n=n.toLowerCase(),translate=window["version"+t.replace(/\./g,"_")][n])}},afterModel:function(e,t){},redirect:function(){},afterModel:function(e,t){},redirect:function(){},renderTemplate:function(e,t){return isValidString(t.queryParams.version)&&"all"!==t.queryParams.version?{outlet:"#outlet",component:"whatsnew-comp"}:{outlet:"#outlet",component:"version-comp"}},afterRender:function(e,t){},actions:{onError:function(e,t,n,r){},willTransition:function(){},didTransition:function(){}},beforeExit:function(){}}),Lyte.Router.registerRoute("index.notecards",{queryParams:["hideHeader"],getResources:function(){return["/public/consolidated_files/public_notecard.js"]},getDependencies:function(){},beforeModel:function(e){var t,n=this;e.dynamicParam&&getPublicNotecardDetailsNR(t=e.dynamicParam,!1).then(function(e){var r=JSON.parse(e);"success"===r.status.toLowerCase()&&(!0===r.user&&window.top===window.self?redirectToWebApp(t):n.notecard=r)}).catch(function(e){})},model:function(e){var t=this;return e.dynamicParam?downloadNotecardNR(e.dynamicParam).then(function(e){if("object"==typeof e){if(e.code)return null;var n=t.notecard;return n.contentXML=e,n}}).catch(function(e){}):null},afterModel:function(e,t){this.currentModel={notecard:e,hideHeader:t.queryParams.hideHeader}},redirect:function(){},renderTemplate:function(e,t){return isValidObject(e.notecard)?{outlet:"#outlet",component:"editor-container"}:{outlet:"#outlet",component:"error-component"}},afterRender:function(e,t){},actions:{onError:function(e,t,n,r){},willTransition:function(){},didTransition:function(){}},beforeExit:function(){}}),Lyte.Router.registerRoute("index.msteams",{getResources:function(){return["/public/consolidated_files/msteams.js"]},getDependencies:function(){},beforeModel:function(e){},model:function(e){},afterModel:function(e,t){},redirect:function(){},renderTemplate:function(e,t){return{outlet:"#outlet",component:"loginpage-container"}},afterRender:function(e,t){},actions:{onError:function(e,t,n,r){},willTransition:function(){},didTransition:function(){}},beforeExit:function(){}});var NOTE=function(){var e={ZIMAGE_TAG:"zimage",ZAUDIO_TAG:"zaudio",ZFILE_TAG:"zfile",ZIMAGEMARKER_TAG:"zimagemarker",ZAUDIOMARKER_TAG:"zaudiomarker",CHECKBOX_TAG:"checkbox",MARK_TAG:"mark",ATTR_RESOURCE_ID:"resource-id",ATTR_RESOURCE_TYPE:"type",ATTR_RESOURCE_NAME:"name",ATTR_RESOURCE_CONSUMER:"consumers",ATTR_WIDTH:"width",ATTR_HEIGHT:"height",ATTR_CHECKED:"checked",PROP_MARKER_PREFIX:"WEB-APP-",CONSUMER_SKETCH:"com.zoho.notebook.sketch",DEFAULT_IMAGE_TITLE:"Untitled",DEFAULT_NOTE_TITLE:"Untitled",DEFAULT_COLLECTION_TITLE:"Untitled",NEW_TEXT_CARD_TEMP_ID:"new-text",NEW_CL_CARD_TEMP_ID:"new-cl",IMAGE_MARKER_DATA_URI:"data:image/jpeg;base64,/9j/4AAQSkZJRgABAQAAAQABAAD/2wCEAAkGBxIPEhIPDxIVDw8PEhUPDw8PEhIPDw8NFRUXFhUVFRUYHSggGBolHRUVITEhJSkrLi4uFx8zODMtNygtLisBCgoKBQUGDg8FDisZExkrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrK//AABEIAL0BCwMBIgACEQEDEQH/xAAXAAEBAQEAAAAAAAAAAAAAAAAAAQIG/8QAFhABAQEAAAAAAAAAAAAAAAAAAAER/8QAFQEBAQAAAAAAAAAAAAAAAAAAAAH/xAAUEQEAAAAAAAAAAAAAAAAAAAAA/9oADAMBAAIRAxEAPwDuLBaKBgaBgaQADQDC0AwwoBAAAUEFABQEFAEWGAgoCIqAAoICggLoIaUA0MMA0DABUA00xcBKBgGkphANNAF00wwFNRQS1dMUE1NXAEtNWgM7RYAgABqyGAyooJQMAKAAAGAAi4UAMUBJCBgKi4AYBAFiLgFiYoCCmAUMMBkxcAQFBApARpGsBmhQAEoKABoAGgAqCghpADTQwFAANFAAwBDVAqLUARUAAABQRdRcAMZpAVUKCiFBUWJQBAFXEAFQBUAFMAFEoDWCACBYC4JFARWQDQoCosAWRAGaulICatAACgaAAUACBoAQ0ADQVUAFqKAlACCpaCVGwGFjSaCKIAKgAAAEBRKAuBQAABAAVFARQEVFBQAAhQFxFAQAUEoAmgGiKBSCYBhiyAFEoCiALQAAQFQAUqKCRUIApoCmIALiLoGAAYAAFhgIYqAUEoLUCgRdSLoJVQBRAFqsqAABqAC6IAsRYgKaigKJAFRQNAATVSgulqUBUVAAwAEAUxFBmqAAaQFE1QRTUAF1LQKABAlJQBdNAkCKCClBBQEKoDNWRQEJFAZFQAXAEkXEUEAAAAXQAEIAUABUACGACgAAAKCCgIlasTARVwwBAwEAoCoYBTAkAoaAKAIoAAQEwVAKGLgISGACpi4AAALhQRTDATQwBaUAQAEAoAUADWoD/9k=",TEXT_CARD_RESOURCE_LIMIT:15,IMAGE_CARD_RESOURCE_LIMIT:15,DEFAULT_NOTE_COLOR:"#61D1FF"};return{get:function(t){return e[t]}}}(),NOTE_TYPE=function(){var e={TEXT:"note/text",MIXED:"note/mixed",IMAGE:"note/image",DOCUMENT:"note/document",FILE:"note/file",CHECKLIST:"note/checklist",BOOKMARK:"note/bookmark"};return{get:function(t){return e[t]}}}();function generateTempNoteId(){return"t-"+getUuid()}function parseCheckbox(e,t){var n=$("<div></div>");n.html(e);for(var r=n[0].getElementsByTagName("checkbox");r.length>0;){var o=r[0].parentElement;$(o).addClass("checklist-wrapper text-element");for(var i=0;i<o.childNodes.length;i++){var a=o.childNodes[i];if("CHECKBOX"===a.tagName){var s=a.innerText?a.innerText:a.textContent;s=ZSEC.Encoder.encodeForHTML(s),o.replaceChild(handleCheckbox(a,t),a);var l=document.createElement("div");l.innerHTML=s,o.insertBefore(l,a.nextSibling)}}}return n[0].outerHTML}function removeCheckboxFromZcontent(e){var t=$("<div></div>");if(void 0!==e&&null!==e){var n=e.getElementsByTagName("ZNote")[0];if(void 0!==n&&null!==n){var r=n.getElementsByTagName("ZContent")[0],o=n.getElementsByTagName("ZNoteColor")[0];o=getTextColor(o.innerHTML),r=r.innerText?r.innerText:r.textContent,t.html(r);var i=t[0].getElementsByTagName("content");i.length>0&&t.html(i[0].innerHTML);for(var a=t[0].getElementsByTagName("checkbox"),s=0;s<a.length;s++){var l=a[s];"true"===l.attributes.checked.value?l.innerHTML="<input type='checkbox' checked/>"+l.textContent:l.innerHTML="<input type='checkbox'/>"+l.textContent}var c=t[0].getElementsByTagName("input");for(s=a.length;s>=0;s--)$(c[s]).unwrap("checkbox");n.getElementsByTagName("ZContent")[0].innerHTML="",n.getElementsByTagName("ZContent")[0].appendChild(t[0])}}return e}function handleCheckbox(e,t){var n=e.getAttribute("checked"),r=document.createElement("input"),o="#ffffff"===t?"checkBox white-checkbox":"checkBox";return $(r).addClass(o),r.setAttribute("type","checkbox"),"true"===n&&r.setAttribute("checked",!0),r.setAttribute("disabled","disabled"),r.style.borderColor=t,r}function getRandomQuote(){return[{quote:"Somewhere, something incredible is waiting to be known.",author:"Carl Sagan"},{quote:"The journey of a thousand miles begins with one step.",author:"Lao Tzu"},{quote:"It is never too late to be what you might have been.",author:"George Eliot"},{quote:"From small beginnings come great things.",author:"Anonymous"},{quote:"Strive not to be a success, but rather to be of value.",author:"Albert Einstein"},{quote:"The beginning is the most important part of the work.",author:"Plato"},{quote:"It's so fine and yet so terrible to stand in front of a blank canvas.",author:"Paul Cezanne"}][Math.floor(7*Math.random())]}function getNotePropertiesFromXml(e){if(void 0!==e&&null!==e){var t=e.getElementsByTagName("ZNote")[0];if(void 0!==t&&null!==t){var n=t.getElementsByTagName("ZNoteColor")[0],r=t.getElementsByTagName("ZTitle")[0],o=t.getElementsByTagName("ZCreatedDate")[0],i=t.getElementsByTagName("ZModifiedDate")[0],a=t.getElementsByTagName("ZLongitude")[0],s=t.getElementsByTagName("ZLatitude")[0],l=t.getElementsByTagName("ZCity")[0],c=t.getElementsByTagName("ZNoteType")[0];return{name:r.textContent,color:n.textContent,created_time:o.textContent,modified_time:i.textContent,longitude:a.textContent,latitude:s.textContent,city:l.textContent,type:c.textContent}}}return null}function parseZnote(e,t){var n,r=$("<div></div>"),o="";if(void 0!==e&&null!==e){var i=e.getElementsByTagName("ZNote")[0],a=!1;if(void 0!==i&&null!==i){var s=i.getElementsByTagName("ZContent")[0],l=i.getElementsByTagName("ZNoteType")[0],c=i.getElementsByTagName("ZNoteColor")[0];c=getTextColor(c.innerHTML),s=s.innerText?s.innerText:s.textContent,a="#ffffff"===c.toLowerCase(),r.html(s);var d=r[0].getElementsByTagName("content");if(d.length>0&&r.html(d[0].innerHTML),"note/checklist"===l.innerHTML){if(r[0].getElementsByTagName("checkbox").length>0)return r[0].outerHTML;o=r[0].outerHTML}else{var u,g,m=r[0].getElementsByTagName("zimage"),p=r[0].getElementsByTagName("zaudio"),f=r[0].getElementsByTagName(NOTE.get("CHECKBOX_TAG")),h=r[0].getElementsByTagName(NOTE.get("ZIMAGEMARKER_TAG")),A=r[0].getElementsByTagName(NOTE.get("ZAUDIOMARKER_TAG")),T=r[0].getElementsByTagName(NOTE.get("MARK_TAG")),v=r[0].getElementsByTagName("blockquote"),E=r[0].getElementsByTagName("pre"),C=r[0].getElementsByTagName("a"),b=h.length,N=A.length,y=m.length,x=p.length,w=v.length,R=E.length;for(u=0;u<y;u++){n=(g=m[0]).parentElement;var O=handleImageResource(t,g);n.replaceChild(O,g)}for(u=0;u<x;u++){n=(g=p[0]).parentElement;var _=handleAudioResource(t,g,a);n.replaceChild(_,g)}for(u=0;u<N;u++){n=(g=A[0]).parentElement;var D=handleMarker(g,a);n.replaceChild(D,g)}for(u=0;u<b;u++){n=(g=h[0]).parentElement;var F=handleMarker(g,a);n.replaceChild(F,g)}var k=T.length;for(u=0;u<k;u++){n=(g=T[0]).parentElement;var B=handleTextHighlight(g);n.replaceChild(B,g)}var I=C.length;for(u=0;u<I;u++)C[u].rel="noopener noreferrer",C[u].target="_blank",checkForNoteLink(C[u]);for(u=0;u<w;u++){let e=v[u];e.getAttribute("style")||addClass(e,"zn-quote")}for(u=0;u<R;u++){let e=E[u];e.getAttribute("style")||addClass(e,"zn-code")}void 0!==f&&f.length>0&&convertCheckListToUl(f,a),o=r[0].innerHTML}}}return o}function getAllZimages(e,t){var n=$("<div></div>"),r=e.getElementsByTagName("ZNote")[0],o=[];if(void 0!==r&&null!==r){var i=r.getElementsByTagName("ZContent")[0];i=i.innerText?i.innerText:i.textContent,n.html(i);var a=n[0].getElementsByTagName("content");a.length>0&&(n=$("<div></div>")).html(a[0].innerHTML),o=getAllImagesFromContent(t,n[0])}return o}function getAllImagesFromContent(e,t){for(var n=[],r=t.getElementsByTagName("zimage"),o=0;o<r.length;o++){var i=r[o].getAttribute(NOTE.get("ATTR_RESOURCE_ID")),a=(r[o].getAttribute(NOTE.get("ATTR_RESOURCE_TYPE")),getEmbedImageSource(e,i));n.push(a)}return n}function getAllZAudio(e,t){var n=$("<div></div>"),r=e.getElementsByTagName("ZNote")[0],o=[];if(void 0!==r&&null!==r){var i=r.getElementsByTagName("ZContent")[0];i=i.innerText?i.innerText:i.textContent,n.html(i);var a=n[0].getElementsByTagName("content");a.length>0&&(n=$("<div></div>")).html(a[0].innerHTML);for(var s=n[0].getElementsByTagName(NOTE.get("ZAUDIO_TAG")),l=0;l<s.length;l++){var c=s[l].getAttribute(NOTE.get("ATTR_RESOURCE_ID")),d={id:c,source:prependAPIPrefix("public/notecards/"+t+"/resources/"+c),type:s[l].getAttribute(NOTE.get("ATTR_RESOURCE_TYPE"))};o.push(d)}}return o}function getAllZFiles(e){var t=e.notecard_id,n=($("<div></div>"),[]),r=e.embed_resources;if(isValidObject(r)&&r.length>0)for(var o=0;o<r.length;o++){var i=r[o],a=i.resource_id,s=prependAPIPrefix("public/notecards/"+t+"/files/"+a);i.id=a,i.source=s,i.type=i.format,n.push(i)}return n}function getResourceMetaDataId(e){return e+"-meta-data"}function handleImageResource(e,t){var n=t.getAttribute(NOTE.get("ATTR_RESOURCE_ID")),r=(t.getAttribute(NOTE.get("ATTR_RESOURCE_TYPE")),t.getAttribute(NOTE.get("ATTR_WIDTH")),t.getAttribute(NOTE.get("ATTR_HEIGHT")),document.createElement("div"));if(void 0!==n||0===n.length){var o=getEmbedImageSource(e,n),i=document.createElement("img");return i.setAttribute("id",n),i.setAttribute("class","notecardImageClass"),i.style.maxWidth="100%",i.setAttribute("src",o),r.appendChild(i),r.setAttribute("class","imgWrapperDiv"),r}return r.setAttribute("class","none"),r}function getEmbedImageSource(e,t){return prependAPIPrefix("public/notecards/"+e+"/resources/"+t)}function handleTextHighlight(e){var t=document.createElement("SPAN");return t.className="highlight",isValidObject(e.firstChild)&&t.appendChild(e.firstChild),t}function handleMarker(e,t){if(e.tagName.toLowerCase()===NOTE.get("ZIMAGEMARKER_TAG")&&isValidObject(e.getAttribute(NOTE.get("ATTR_RESOURCE_ID")))&&e.getAttribute(NOTE.get("ATTR_RESOURCE_ID")).startsWith("WEB-APP-")){var n=document.createElement("img"),r=e.getAttribute(NOTE.get("ATTR_RESOURCE_ID")).split("WEB-APP-")[1];return n.setAttribute("src",r),n}var o=document.createElement("div");return o.style.height="100pxpx",o.style.width="100pxpx",e.tagName.toLowerCase()===NOTE.get("ZIMAGEMARKER_TAG")?$(o).addClass(t?"markerDiv whiteImageMarkerDiv":"markerDiv imageMarkerDiv"):e.tagName.toLowerCase()===NOTE.get("ZIMAGEMARKER_TAG")&&$(o).addClass(t?"markerDiv whiteAudioMarkerDiv":"markerDiv audioMarkerDiv"),o}function handleAudioResource(e,t,n){var r=t.getAttribute(NOTE.get("ATTR_RESOURCE_ID")),o=t.getAttribute(NOTE.get("ATTR_RESOURCE_TYPE")),i={resourceId:r,type:o},a=document.createElement("div");if(void 0!==r||0===r.length){a.setAttribute("id",r),a.setAttribute("class",n?"notecardAudioClass whitePlayer":"notecardAudioClass"),$(a).attr("data-format",o);var s='<div id="play_'+r+'" class="audioPlayIcon"> </div><div id="waveform_'+r+'" class="waveformContainer"></div> <div id="progressTime_'+r+'" class="progressTimeDiv"></div> <div id="duration_'+r+'" class="durationDiv"></div>';a.innerHTML=s;var l=document.createElement("input");return l.setAttribute("type","hidden"),l.setAttribute("value",JSON.stringify(i)),l.setAttribute("id",getResourceMetaDataId(r)),document.body.appendChild(l),a}return a.setAttribute("class","none"),a}function getZImageCount(e){return e.getElementsByTagName(NOTE.get("ZIMAGE_TAG")).length+e.getElementsByTagName(NOTE.get("ZIMAGEMARKER_TAG")).length}function getCheckListItemsCount(e){try{for(var t=e.getElementsByTagName(NOTE.get("CHECKBOX_TAG")),n={length:t.length},r=0,o=0;o<t.length;o++)"true"!==t[o].getAttribute("checked")&&r++;return n.unchecked=r,n}catch(e){failedAlert("Error occurred while counting checklist items "+e)}}function countWordsAndChars(e){try{var t={},n=getWordsByWordBoundaries(extractString(e,""));return t.words=n.length,t.characters=getCharacterCountFromWords(n),t}catch(e){failedAlert("Error occured while getting word cout "+e)}return null}function getCharacterCountFromWords(e){for(var t=0,n=0;n<e.length;n++)t+=e[n].length;return t}function extractString(e,t){var n=e.childNodes;if(0===n.length){if(3===e.nodeType)return t+e.textContent+" "}else for(var r=0;r<n.length;r++)t=extractString(n[r],t);return t}function extractSubstr(e,t,n){return n?e.replace(/[^\w\s]|_/g,"").replace(/\s+/g," ").match(t)||[]:e.replace(/[^\w\s]|_/g,"").replace(/\s+/g," ").toLowerCase().match(t)||[]}function embedResourceLength(e){var t=(new XMLSerializer).serializeToString(e);return(t.match(/zimage/g)||[]).length+(t.match(/zaudio/g)||[]).length/2}function getWordsByWordBoundaries(e,t){return extractSubstr(e,/\b[a-z\d]+\b/g,t)}function removeUnrecogonizedChars(e){return e.replace(/&nbsp;/gi,"&#160;")}function sanitizeNoteContent(e,t,n){let r=t;t.nodeType||(r=getNode(t));var o=(new XMLSerializer).serializeToString(r);return convertImagesToZImages(e,o=getXmlDoc(o=removeUnrecogonizedChars(o)),n),sanitizeAfterConversionOfImages(e,o)}function sanitizeAfterConversionOfImages(e,t){convertWavesToZaudio(e,t),parseChecklist(t),convertHighlightToMark(t),parseCodeBlocks(t),parseBlockQuotes(t),removeEmptyDivs(t);for(var n=t.getElementsByClassName("imgWrapperDiv");n.length>0;)n[0].removeAttribute("class");var r=document.createElement("content");r.appendChild(t.documentElement);for(var o=0;o<r.childNodes.length;o++)3!==r.childNodes[o].nodeType&&r.childNodes[o].removeAttribute("xmlns");return r.removeAttribute("xmlns"),r}function convertHighlightToMark(e){for(var t=e.getElementsByClassName("highlight"),n=t.length,r=0;r<n;r++){var o=t[0],i=createNode(e,NOTE.get("MARK_TAG"));isValidObject(o.firstChild)&&i.appendChild(o.firstChild),o.parentNode.replaceChild(i,o)}}function convertWavesToZaudio(e,t){for(var n=t.getElementsByClassName("notecardAudioClass"),r=n.length,o=0;o<r;o++){var i=n[0],a=createNode(t,NOTE.get("ZAUDIO_TAG")),s=i.id,l=document.getElementById(getResourceMetaDataId(s)).getAttribute("value");l=JSON.parse(l),a.setAttribute(NOTE.get("ATTR_RESOURCE_ID"),l.resourceId),a.setAttribute(NOTE.get("ATTR_RESOURCE_TYPE"),l.type),i.parentNode.replaceChild(a,i)}}function parseCodeBlocks(e){for(var t=e.getElementsByClassName("zn-code"),n=t.length,r=0;r<n;r++){var o=t[0];(o.innerText?o.innerText:o.textContent).trim().length>0?(removeClass(o,"zn-code"),o.className.trim().length<1&&o.removeAttribute("class")):o.parentNode.removeChild(o)}}function parseBlockQuotes(e){for(var t=e.getElementsByClassName("zn-quote"),n=t.length,r=0;r<n;r++){var o=t[0];(o.innerText?o.innerText:o.textContent).trim().length>0?(removeClass(o,"zn-quote"),o.className.trim().length<1&&o.removeAttribute("class")):o.parentNode.removeChild(o)}}function removeEmptyDivs(e){for(var t=e.getElementsByTagName("div"),n=t.length,r=0,o=0;o<n;o++){var i=t[r],a=!1;for(1===i.childNodes.length&&(a=!0);a;)if(a=!1,r++,o++,1===i.childNodes.length){var s=i.childNodes[0];if("div"===s.tagName){a=!0;var l=s.childNodes;i.removeChild(s),r--;for(var c=l.length,d=0;d<c;d++)i.appendChild(l[0])}}r++}}function getXmlString(e){return(new XMLSerializer).serializeToString(e)}function convertImagesToZImages(e,t,n){for(var r=t.getElementsByTagName("img"),o=r.length,i=0;i<o;i++){var a=r[0],s=a.getAttribute("src");if("notecardImageClass"===a.getAttribute("class")){var l=createNode(t,NOTE.get("ZIMAGE_TAG")),c=a.id,d=peekRecord("embed-resource",c);l.setAttribute(NOTE.get("ATTR_RESOURCE_ID"),d.resource_id),l.setAttribute(NOTE.get("ATTR_RESOURCE_TYPE"),d.type),isValidObject(d.width)&&l.setAttribute(NOTE.get("ATTR_WIDTH"),d.width),isValidObject(d.height)&&l.setAttribute(NOTE.get("ATTR_HEIGHT"),d.height),a.parentNode.replaceChild(l,a)}else{var u=createNode(t,NOTE.get("ZIMAGEMARKER_TAG"));let e=s;u.setAttribute(NOTE.get("ATTR_RESOURCE_ID"),getMarkerResourceId(e)),a.parentNode.replaceChild(u,a)}}}function getMarkerResourceId(e){return NOTE.get("PROP_MARKER_PREFIX")+e}function updateZNote(e,t){var n=document.implementation.createDocument(null,"ZNote",null),r=n.documentElement,o=createNode(n,"ZMeta");isValidObject(t.name)&&""!==t.name.trim()||(t.name=NOTE.get("DEFAULT_NOTE_TITLE"));var i=createNodeWithValue(n,"ZTitle",t.name);o.appendChild(i);var a=createNodeWithValue(n,"ZCreatedDate",t.created_time);o.appendChild(a);var s=t.modified_time;void 0===s&&""!==s||(s=getDateInUTC(currentTimeInMilliSeconds()));var l=createNodeWithValue(n,"ZModifiedDate",s);o.appendChild(l);var c=createNode(n,"ZLocation"),d=createNodeWithValue(n,"ZLongitude",t.longitude);c.appendChild(d);var u=createNodeWithValue(n,"ZLatitude",t.latitude);c.appendChild(u);var g=createNodeWithValue(n,"ZCity",ZSEC.Encoder.encodeForHTML(t.location));c.appendChild(g),o.appendChild(c);var m=createNodeWithValue(n,"ZNoteColor",t.color);o.appendChild(m);var p=createNodeWithValue(n,"ZNoteType",t.type);o.appendChild(p),r.appendChild(o);var f=createNode(n,"ZContent"),h=n.createElement("dummy");""===e&&(e=createNode(n,"content")).appendChild(createNode(n,"div")),h.appendChild(e),h.childNodes[0].removeAttribute("xmlns");var A=n.createCDATASection(h.innerHTML);return f.appendChild(A),r.appendChild(f),n}function createZnote(e){return updateZNote("",e)}function createNodeWithEncodedValue(e,t,n){var r=createNode(e,t);return r.innerHTML=n,r}function createNodeWithValue(e,t,n){var r=createNode(e,t),o=e.createTextNode(n);return r.appendChild(o),r}function createNode(e,t){return e.createElement(t)}function createNodeWithName(e){return createNode(document.implementation.createDocument(null,"ZNote",null),e)}function createResourceTag(e){var t=document.implementation.createDocument(null,"ZNote",null),n="dummy";e.format.startsWith("image")&&(n=NOTE.get("ZIMAGE_TAG"));var r=createNode(t,n);return r.setAttribute(NOTE.get("ATTR_RESOURCE_ID"),e.resource_id),r.setAttribute(NOTE.get("ATTR_RESOURCE_TYPE"),e.format),r}function getNode(e){var t=document.createElement("div");return t.innerHTML=e,t.childNodes.length>1&&$(t).wrapInner(document.createElement("div")),t.childNodes[0]}function getNoteColor(){var e=["#FFFFFF","#FAD154","#CFC4FF","#F7BFFF","#61D1FF","#85EBD9","#C4FFED","#DEF58F","#D9E8F0","#FFED7D","#FFD921","#FF9C00","#FA9959","#B3D9E6","#BAC28A","#D1EBB8","#D1D9C9","#FFDB70","#FFA8B3","#E3E3E3","#ABD1C9","#E8BA2B","#9CC2D6","#D4E0E3","#FFC27D","#E8B01C","#57C2FF","#BFD9C2","#82D9DE","#ABC29E","#F0C221","#301294","#2175FF","#2E3BA3","#0087D4","#00549E","#0096A8"],t="Random";try{var n=peekRecord("userprofile","default");n&&n.default_notecard_color&&(t=n.default_notecard_color)}catch(e){let t;t=null}return void 0===t||"random"===t.toLocaleLowerCase()?e[Math.floor(Math.random()*e.length)]:t}function parseChecklist(e){for(var t=e.getElementsByClassName("checklist"),n=t.length,r=0;r<n;r++){for(var o=t[r],i=$(o).children("li"),a=0;a<i.length;a++){var s=i[a];if(s.textContent.trim().length>0){var l=createNodeWithEncodedValue(e,NOTE.get("CHECKBOX_TAG"),s.innerHTML),c=$(s).data("meta");void 0!==c?l.setAttribute(NOTE.get("ATTR_CHECKED"),c.checked):l.setAttribute(NOTE.get("ATTR_CHECKED"),!1);var d=createNode(e,"div");d.appendChild(l),s.parentNode.replaceChild(d,s)}else s.parentNode.removeChild(s)}var u=document.createElement("div");u.className="checklist",u.innerHTML=o.innerHTML,o.parentNode.replaceChild(u,o)}}function convertCheckListToUl(e,t){sanitizeCheckbox(e);var n=e[0].parentNode,r=convertCheckBoxesToLi(e);n=sanitizeParent(n);var o=getCheckboxParent(e[0]),i=document.createElement("ul");i.className=t?"checklist white_cl":"checklist";for(var a=document.createElement("div"),s=0;s<r.length;s++){if(!(n.childNodes.length>0))return isValidObject(o.parentNode)?replaceULinDOM(i,o,o.parentNode):($(o).wrapInner("<div></div>"),replaceULinDOM(i,o.firstElementChild,o)),void(e.length>0&&convertCheckListToUl(e,t));n.removeChild(n.childNodes[0]),a.innerHTML=r[s],i.appendChild(a.firstChild)}isValidObject(o.parentNode)?replaceULinDOM(i,o,o.parentNode):($(o).wrapInner("<div></div>"),replaceULinDOM(i,o.firstElementChild,o))}function sanitizeParent(e){var t,n=$(e).children("checkbox");if(e.childElementCount!==n.length){for(var r=1;r<n.length;r++){var o=$(n[r]).prev();if(null===o||!o.is("checkbox")){t=r;break}}return $(n).slice(0,t).wrapAll("<div></div>"),n[0].parentNode}return e}function replaceULinDOM(e,t,n){void 0===n||null===n?$(t).replaceWith(e):n.replaceChild(e,t)}function convertCheckBoxesToLi(e){for(var t=[],n=0;n<e.length;n++){var r=e[n],o=r.getAttribute("checked"),i={checked:o},a=document.createElement("li"),s="true"===o?"checkbox checked":"checkbox";$(a).addClass(s),a.setAttribute("data-meta",JSON.stringify(i)),$(a).data("meta",JSON.stringify(i)),a.innerHTML=r.innerHTML,t.push(a.outerHTML)}return t}function sanitizeCheckbox(e){for(var t=0;t<e.length;t++){var n=e[t],r=n.innerText?n.innerText:n.textContent,o=n.parentNode;r.trim().length>0?1===o.childElementCount&&o.textContent.length>0&&$(n).unwrap():(1===o.childElementCount&&$(n).unwrap(),n.parentNode.removeChild(n),t-=1)}}function getCheckboxParent(e){var t=e.parentNode;return 1===t.childElementCount&&t.textContent.length>0&&"CHECKBOX"!==t.children[0].tagName?($(e).unwrap(),getCheckboxParent(e)):t}function getImageNoteZNote(e,t){for(var n=document.implementation.createDocument(null,"content",null),r=0;r<t.length;r++){var o=createNode(n,NOTE.get("ZIMAGE_TAG")),i=t[r].resource_id;o.setAttribute(NOTE.get("ATTR_RESOURCE_ID"),i);var a=peekRecord("embed-resource",i);o.setAttribute(NOTE.get("ATTR_RESOURCE_TYPE"),a.format),n.documentElement.appendChild(o)}return updateZNote(n.documentElement,e)}function getSketchNoteZNote(e,t){for(var n=document.implementation.createDocument(null,"content",null),r=0;r<t.length;r++){var o=createNode(n,NOTE.get("ZIMAGE_TAG"));o.setAttribute(NOTE.get("ATTR_RESOURCE_ID"),t[r].resource_id),o.setAttribute(NOTE.get("ATTR_RESOURCE_TYPE"),t[r].type),o.setAttribute(NOTE.get("ATTR_RESOURCE_CONSUMER"),NOTE.get("CONSUMER_SKETCH")),n.documentElement.appendChild(o)}return updateZNote(n.documentElement,e)}function getAudioNoteZNote(e,t){for(var n=document.implementation.createDocument(null,"content",null),r=0;r<t.length;r++){var o=createNode(n,NOTE.get("ZAUDIO_TAG"));o.setAttribute(NOTE.get("ATTR_RESOURCE_ID"),t[r].id),o.setAttribute(NOTE.get("ATTR_RESOURCE_TYPE"),t[r].type),n.documentElement.appendChild(o)}return updateZNote(n.documentElement,e)}function getFileNoteZNote(e,t){var n=document.implementation.createDocument(null,"content",null);if(void 0!==t&&null!==t)for(var r=0;r<t.length;r++){var o=createNode(n,NOTE.get("ZFILE_TAG"));o.setAttribute(NOTE.get("ATTR_RESOURCE_ID"),t[r].resource_id),o.setAttribute(NOTE.get("ATTR_RESOURCE_TYPE"),t[r].format),n.documentElement.appendChild(o)}return updateZNote(n.documentElement,e)}function processNoteContentForCopy(e){var t=e.contentXML,n=getDateInUTC(currentTimeInMilliSeconds());t.getElementsByTagName("ZCreatedDate").innerHTML=n,t.getElementsByTagName("ZModifiedDate").innerHTML=n;var r=(new XMLSerializer).serializeToString(t),o=new FormData;return o.append("attachment",r),o.append("JSONString",JSON.stringify({notes:"Copied from Web Client"})),o}function sanitizeCheckListNoteContent(e){for(var t=document.createElement("div"),n=0;n<e.length;n++){var r=e[n];if(r.content.trim().length>0){var o=parseCheckListItem(r);t.appendChild(o)}}var i=getXmlString(t);i=getXmlDoc(i=removeUnrecogonizedChars(i));var a=document.createElement("content");for(a.innerHTML=$(i.documentElement).html(),n=0;n<a.childNodes.length;n++)3!==a.childNodes[n].nodeType&&a.childNodes[n].removeAttribute("xmlns");return a.removeAttribute("xmlns"),a}function parseCheckListItem(e){var t=createNodeWithEncodedValue(document,NOTE.get("CHECKBOX_TAG"),e.content);t.setAttribute(NOTE.get("ATTR_CHECKED"),e.checked);var n=createNode(document,"div");return n.appendChild(t),n}function parseChecklistNote(e){var t=[],n=[],r=$("<div></div>"),o=e.getElementsByTagName("ZNote")[0];if(void 0!==o&&null!==o){var i=o.getElementsByTagName("ZContent")[0];i=i.innerText?i.innerText:i.textContent,r.html(i);var a=r[0].getElementsByTagName("content");a.length>0&&(r=$("<div></div>")).html(a[0].innerHTML);var s=r[0].getElementsByTagName("checkbox");if(s.length>0)for(var l=0;l<s.length;l++){var c=getCheckboxObject(s[l]);n.push(c)}}if(n.length>0){var d=n.filter(function(e){return!1===e.checked});d.length>0&&(t=t.concat(d));var u=n.filter(function(e){return!0===e.checked});u.length>0&&(t=t.concat(u))}return t}function parseChecklistNoteFromContent(e){var t=[],n=[],r=$("<div></div>");r.html(e);var o=r[0].firstElementChild.getElementsByTagName("checkbox");if(o.length>0)for(var i=0;i<o.length;i++){var a=getCheckboxObject(o[i]);n.push(a)}if(n.length>0){var s=n.filter(function(e){return!1===e.checked});s.length>0&&(t=t.concat(s));var l=n.filter(function(e){return!0===e.checked});l.length>0&&(t=t.concat(l))}return t}function getCheckboxObject(e){var t=e.getAttribute("checked");t="true"==t;var n=e.innerText;return{checked:t,content:n=ZSEC.Encoder.encodeForHTML(n),showOptions:n.length>0}}function initialiseWaveSurfer(e){var t=getWaveColor(e),n=WaveSurfer.create({container:"#waveform-container",waveColor:t,progressColor:e});return n.on("loading",function(){$(".play-pause-icon").addClass("hide-icon"),$(".audio-loading").removeClass("hide-icon")}),n.on("ready",function(){$(".audio-loading").addClass("hide-icon"),$(".play-pause-icon").removeClass("hide-icon")}),n.on("finish",function(){$(".play-pause-icon").removeClass("audio-playing-icon")}),n}function initialiseWaveSurferForEditor(e,t,n){var r=n?"#212121":"#ffffff",o=document.querySelector("#waveform_"+e),i=WaveSurfer.create({container:o,waveColor:"grey",progressColor:r,height:72});return i.load(t),document.querySelector("#duration_"+e).innerHTML=i.getDuration(),i.on("finish",function(){var t=document.querySelector("#play_"+e);$(t).removeClass("playingIcon")}),i.on("pause",function(){var t=document.querySelector("#play_"+e);$(t).removeClass("playingIcon")}),i.on("play",function(){var t=document.querySelector("#play_"+e);$(t).addClass("playingIcon")}),i.on("loading",function(){$(".play-pause-icon").addClass("hide-icon"),$(".audio-loading").removeClass("hide-icon")}),i.on("ready",function(){$(".audio-loading").addClass("hide-icon"),$(".play-pause-icon").removeClass("hide-icon")}),$(document.body).on("mousedown","#play_"+e,function(t){t.preventDefault(),t.stopPropagation(),$(t.target).toggleClass("playingIcon"),bindClickEventForPlay(e)}),i}function getWaveColor(e){return"#ffffff"===e.toLowerCase()?"rgba(255,255,255,0.3)":"rgba(0,0,0,0.3)"}function cleanUpNoteProperties(e){return isValidObject(e.name)&&e.name.toLowerCase()===NOTE.get("DEFAULT_NOTE_TITLE")&&(e.name=""),e}function isValidNoteContent(e){let t=extractString(e,"");return e.getElementsByTagName(NOTE.get("ZIMAGE_TAG")).length>0||e.getElementsByTagName(NOTE.get("ZAUDIO_TAG")).length>0||e.getElementsByTagName(NOTE.get("ZFILE_TAG")).length>0||""!==t.trim()}function isChecklistNote(e){return"note/checklist"===e.type}function getNoteDynamicTitle(e,t,n){if(t=toHTML(t.trim()),isValidObject(e)&&(!isValidObject(e)||"untitled"!==e.toLowerCase()))return e;if("note/image"!==n&&"note/checklist"!==n&&"note/audio"!==n&&"note/sketch"!==n&&isValidObject(t)){var r=extractString($(t)[0],"");if(isValidObject(r)){var o=r.trim().substring(0,50);if(isValidObject(o))return o}}return""}function getContentFromZNote(e){return getXmlDoc(e.getElementsByTagName("ZContent")[0].childNodes[0].nodeValue).firstChild}function removeEmptyLiFromDesc(e){for(var t=$(e).find("li"),n=0;n<t.length;n++)0===t[n].textContent.trim().length&&$(t[n]).remove();var r=$(e).find(".checklist-wrapper");for(n=0;n<r.length;n++)0===r[n].textContent.trim().length&&$(r[n]).remove();return e}function processExtraSettings(e){var t=e.web_editor_font;void 0!==t&&appendFontLink(getWebFontFamily(t));var n=e.web_app_tips_status;void 0!==n&&null!==n&&n.length>0?(window.ZN_META.user.extra_settings.showNotebooksTip=!(n.indexOf("notebook")>-1),window.ZN_META.user.extra_settings.showGroupTip=!(n.indexOf("group")>-1)):setDefaultValuesInExtraSettings()}function setDefaultValuesInExtraSettings(){window.ZN_META.user.extra_settings.showNotebooksTip=!0,window.ZN_META.user.extra_settings.showGroupTip=!0}function updateVersionPropsFromXML(e,t){var n=e.getElementsByTagName("ZNote")[0].getElementsByTagName("ZMeta")[0],r=n.getElementsByTagName("ZTitle")[0].innerHTML;setValue(t,"name",r);var o=n.getElementsByTagName("ZNoteColor")[0].innerHTML;setValue(t,"color",o)}function saveNoteInCache(e,t){var n=(new XMLSerializer).serializeToString(t),r=new FormData;r.append("attachment",n),saveNotecardInCacheNR(e.notebook_id,e.notecard_id,r).then(function(n){var r=JSON.parse(n);"success"===r.status.toLowerCase()?setValue(e,"contentXML",t):1126===r.code&&(setValue(e,"notecard_id",r.notecard_id),setValue(e,"contentXML",t))}).catch(function(e){showAlert(translate.generalOption.updateFailed,translate.options.okay)})}function getEmbedResourceDownloadLink(e,t){return prependAPIPrefix("public/notecards/"+e.notecard_id+"/resources/"+t)+"?"+getznbcsr()}function createNewNotecardObject(e,t,n){var r=peekRecord("userprofile","default");if(isValidObject(e)||(isValidObject(r)&&(e=r.default_notebook_id),isValidObject(e)&&"default"!==e.toLowerCase()||(e=setDefaultNotebook())),isValidObject(e)){var o=getLocation(),i=isValidObject(o.location)?o.location:"",a=isValidObject(o.longitude)?o.longitude:0,s=isValidObject(o.latitude)?o.latitude:0,l=generateTempNoteId(),c=getDateInUTC(currentTimeInMilliSeconds()),d={temp_id:l,name:NOTE.get("DEFAULT_NOTE_TITLE"),created_time:c,modified_time:c,latitude:s,longitude:a,location:i,color:getNoteColor(),type:t,notebook_id:e,notecard_id:l};pushPayload("notecard",d);var u=peekAll("notecard");return Lyte.arrayUtils(u,"unshift",u[u.length-1]),Lyte.arrayUtils(u,"pop"),peekRecord("notecard",d.temp_id)}showAlert("Please choose a default Notebook")}function createNewSegmentObject(e,t,n){var r=createNewNotecardObject(e,t,n),o={temp_id:r.notecard_id,segment_id:r.notecard_id,name:r.name,notebook_id:r.notebook_id,created_time:r.created_time,modified_time:r.modified_time,last_accessed_time:r.last_accessed_time,notecards:[r],notebook:{notebook_id:r.notebook_id}};pushPayload("segment",[o]);var i=(o=peekSegment(r.notecard_id)).notebook.segments;return Lyte.arrayUtils(i,"unshift",i[i.length-1]),Lyte.arrayUtils(i,"pop"),setValue(r,"segment",o),o}function createNewCollectionObject(e,t,n){var r=createNewNotecardObject(t,n);r.collection_id=e;var o=peekSegment(e);if(!o)return null;o.notecards,setValue(r,"segment",o);var i=o.notebook.segments;return Lyte.arrayUtils(i,"unshift",i[i.length-1]),Lyte.arrayUtils(i,"pop"),r}function convertULToArray(e,t){for(var n=e.getElementsByTagName("LI"),r=[],o=0;o<n.length;o++){var i,a=!0;0===(i=n[o].getElementsByClassName("editableDiv")[0].innerHTML).length&&(a=!1);var s={checked:t,content:i,showOptions:a};r.push(s)}return r}function convertSecondsTohhmmss(e,t){var n=function(e){return e<10?"0"+e:e};return[n(Math.floor(e%3600/60)),n(Math.floor(e%60))].join(void 0!==t?t:":")}function redirectToWebApp(e){var t=document.domain;t.indexOf("zohopublic.")>-1&&(t=t.replace("zohopublic","zoho"));var n="https://"+t+"/app/index.html#/all-notes/"+e;window.location.assign(n)}function getNotecardIdFromLink(e){return e.split("notes/")[1]}function checkForNoteLink(e){var t=e.getAttribute("href");if(document.domain,isValidString(t)&&t.includes("zohonotebook://notes/")){var n=getNotecardIdFromLink(t);isValidString(n)&&n.length>0&&(e.setAttribute("href","https://"+document.domain+"/public/notes/"+n),e.setAttribute("target","_blank"),e.setAttribute("rel","noopener noreferrer"))}}function getResourceDownloadUrl(e,t){return prependAPIPrefix("public/notecards/"+e+"/resources/"+t)}function bindClickEventForPlay(e){document.querySelectorAll("text-note-view")[0].getData("wavesurfer_"+e).playPause()}function getDateFromUTCTime(e){let t=e.substring(0,4),n=e.substring(5,7),r=e.substring(8,10),o=e.substring(11,13),i=e.substring(14,16),a=e.substring(17,19),s=e.substring(19,24);return new Date(n+"/"+r+"/"+t+" "+o+":"+i+":"+a+" UTC"+s)}function parseContactZnote(e,t){var n={},r=$("<div></div>");if(void 0!==e&&null!==e){var o=e.getElementsByTagName("ZNote")[0];if(void 0!==o&&null!==o){var i=o.getElementsByTagName("ZContent")[0];i=i.innerText?i.innerText:i.textContent,r.html(i);var a,s=r[0].getElementsByTagName("contact");if(s.length>0&&r.html(s[0]),n.fullName=getValueOfTag(r[0],"fullname"),n.firstName=getValueOfTag(r[0],"firstname"),n.middleName=getValueOfTag(r[0],"middlename"),n.lastName=getValueOfTag(r[0],"lastname"),(a=r[0].getElementsByTagName("organizations")).length>0){let e=[];(l=a[0].getElementsByTagName("organization")).length>0&&(e=getVaulesOfTagsInArray(l),n.organizations=e)}if((a=r[0].getElementsByTagName("websites")).length>0){let e=[];(l=a[0].getElementsByTagName("website")).length>0&&(e=getVaulesOfTagsInArray(l),n.websites=e)}if((a=r[0].getElementsByTagName("jobs")).length>0){let e=[];(l=a[0].getElementsByTagName("job")).length>0&&(e=getVaulesOfTagsInArray(l),n.jobs=e)}if((a=r[0].getElementsByTagName("emails")).length>0){let e=[];(l=a[0].getElementsByTagName("email")).length>0&&(e=getVaulesOfTagsInArray(l),n.emails=e)}if((a=r[0].getElementsByTagName("numbers")).length>0){let e=[];(l=a[0].getElementsByTagName("number")).length>0&&(e=getVaulesOfTagsInArray(l),n.numbers=e)}if((a=r[0].getElementsByTagName("dates")).length>0){let e=[];(l=a[0].getElementsByTagName("date")).length>0&&(e=getVaulesOfTagsInArray(l),n.dates=e)}if((a=r[0].getElementsByTagName("socialnetworks")).length>0){let e=[];(l=a[0].getElementsByTagName("socialnetwork")).length>0&&(e=getVaulesOfTagsInArray(l),n.socialnetworks=e)}if((a=r[0].getElementsByTagName("addresses")).length>0){var l;let e=[];(l=a[0].getElementsByTagName("address")).length>0&&(e=parseAddressTags(l),n.addresses=e)}var c=r[0].getElementsByTagName("cardimage");if(c.length>0){let e=[];e=parseImagesTag(c),n.cardImages=e}var d=r[0].getElementsByTagName("profileimage");if(d.length>0){let e=[];e=getImageObject(d[0]),n.profileImage=e}return n}}return n}function getValueOfTag(e,t){var n=e.getElementsByTagName(t);return n.length>0?n[0].innerText:""}function getVaulesOfTagsInArray(e){for(var t=[],n=0;n<e.length;n++)t.push(e[n].innerText);return t}function parseAddressTags(e){for(var t=[],n=0;n<e.length;n++)t.push(getAddressObject(e[n]));return t}function getAddressObject(e){var t={},n=getValueOfTag(e,"street");isValidString(n)&&(t.street=n);var r=getValueOfTag(e,"city");isValidString(r)&&(t.city=r);var o=getValueOfTag(e,"country");isValidString(o)&&(t.country=o);var i=getValueOfTag(e,"region");isValidString(i)&&(t.region=i);var a=getValueOfTag(e,"code");return isValidString(a)&&(t.code=a),t}function parseImagesTag(e){for(var t=[],n=0;n<e.length;n++)t.push(getImageObject(e[n]));return t}function getImageObject(e){var t={},n=e.getAttribute("type");isValidString(n)&&(t.type=n);var r=e.getElementsByTagName("zimage")[0].getAttribute(NOTE.get("ATTR_RESOURCE_ID"));return t.resource_id=r,t}function findBy(e,t,n,r,o){for(var i=0;i<e.length;i++)if(e[i][t]===n)return r?i:o?{index:i,value:e[i]}:e[i];return-1}function isMobileBrowser(){var e=window.innerWidth>0?window.innerWidth:screen.width;return e<=767||window.innerHeight>e}function setTheme(e){var t=document.body;if(t){if(t.removeAttribute("class"),"default"===e)return;"dark"===e?t.classList.add("night-mode"):t.classList.add("contrast-mode")}}function getBookmarkDescMixin(e){var t="";if(e&&"note/bookmark"===e.type){var n=sanitizeDescriptionString(e.description);if(isValidObject(n)&&"undefined"!==n.toLowerCase()){var r=toHTML(n.trim());linkDiv=r.querySelector("a"),linkDiv&&(t=sanitizeLink(linkDiv.href))}}return t}function getReaderViewContent(e){var t=e.querySelector("ZReaderContent");if(isValidObject(t)&&t.textContent){var n=t.textContent;return n.includes("<a href")&&(n=n.replace(/<a href/g,'<a target="_blank" href')),n}return null}function sanitizeDescriptionString(e){var t=(new ZSEC.HTMLPurifier).sanitize(e);return(t=t.replace(/[\u2028\u2029]/gim,"<br />")).replace(/[\u0000-\u001f\u007f-\u009f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/gim,"")}function isValidObject(e){return void 0!==e&&null!==e&&"null"!==e&&""!==e}function isValidString(e){try{if(void 0!==e&&""!==e.trim())return!0}catch(e){return!1}return!1}function versionSlice(e){var t=e.slice(0,e.length-2);return 1===t.length&&(versions.includes(t+"_0")?t+=".0":t=versions[versions.length-1].replace("_",".")),t}function finalSlicedVersion(e){for(e=versionSlice(e);!isValidObject(window["version"+e.replace(/\./g,"_")])&&(e=versionSlice(e),!isValidObject(window["version"+e.replace(/\./g,"_")])););return e}function getXmlDoc(e){if(window.DOMParser)return(new window.DOMParser).parseFromString(e,"text/xml");if(void 0!==window.ActiveXObject&&new window.ActiveXObject("Microsoft.XMLDOM")){var t=new window.ActiveXObject("Microsoft.XMLDOM");return t.async="false",t.loadXML(e),t}return null}var archive={mimeType:["application/zip","application/x-compressed-zip","application/x-zip-compressed","application/x-rar-compressed","application/x-rar","application/x-tar","application/x-gzip","application/x-gtar"],extension:["zip","rar","tar.gz","tgz","gz","tar"]},audio={mimeType:["audio/mpeg","audio/mp3","video/mpeg","audio/wav","audio/x-wav","audio/vorbis","application/ogg","audio/ogg","audio/x-m4a","audio/mp4"],extension:["mp3","mpeg","wav","ogg"]},image={mimeType:["image/jpeg","image/png","image/gif","image/bmp","image/x-ms-bmp","image/svg+xml","image/tiff"],extension:["jpeg","jpg","png","gif","bmp","svg"]},markup={mimeType:["text/html"],extension:["css","html","htm"]},codeFiles={mimeType:["text/x-csrc","text/x-c","text/x-c++src","text/x-chdr","text/x-c++hdr","application/x-javascript","text/javascript","text/css"],extension:["php","c","cpp","h","hpp","js"]},videoFiles={mimeType:["video/webm","application/x-matroska","video/mp4","video/3gpp","video/quicktime","video/avi","video/msvideo","application/x-troff-msvideo","video/x-msvideo","video/MP2P","video/MP1S","video/x-ms-wmv","video/x-flv","video/ogg"],extension:["webm","mpeg4","mp4","3gpp","3gpp","mov","avi","mpegps","wmv","flv","ogg","ogv","mpeg","mpg"]},pdfFiles={mimeType:["application/pdf"],extension:["pdf"]},presentationFiles={mimeType:["application/mspowerpoint","application/powerpoint","application/vnd.ms-powerpoint","application/x-mspowerpoint","application/vnd.openxmlformats-officedocument.presentationml.presentation","application/vnd.oasis.opendocument.presentation","application/vnd.openxmlformats-officedocument.presentationml.slideshow"],extension:["ppt","pptx","odp","ppsx"]},spreadSheetFiles={mimeType:["application/excel","application/vnd.ms-excel","application/x-excel","application/x-msexcel","application/vnd.openxmlformats-officedocument.spreadsheetml.sheet","application/vnd.oasis.opendocument.spreadsheet","text/csv"],extension:["xls","xlsx","ods","csv"]},docFiles={mimeType:["application/msword","application/vnd.openxmlformats-officedocument.wordprocessingml.document","application/vnd.ms-xpsdocument","application/oxps","application/msoffice","application/ooxml","text/rtf","application/rtf","text/plain","application/vnd.oasis.opendocument.text"],extension:["doc","docx","xps","odt","rtf","txt"]},otherFiles={mimeType:["application/x-font-ttf","application/x-font-truetype","application/x-font-opentype","application/postscript","application/octet-stream"],extension:["tiff","tif","otf","eps","ps"]};function getFileDetails(e,t){var n=getFileExtenstionFromName(e);return n&&(n=n.toLowerCase()),$.inArray(t,archive.mimeType)>-1&&$.inArray(n,archive.extension)>-1?{type:"ZIP",bgcolor:"#F6C044",extension:n,previewClass:"izip-file"}:$.inArray(t,audio.mimeType)>-1&&$.inArray(n,audio.extension)>-1?{type:"AUDIO",bgcolor:"#009688",extension:n,previewClass:"iaudio-file"}:$.inArray(t,image.mimeType)>-1&&$.inArray(n,image.extension)>-1?{type:"IMAGE",bgcolor:"#00A768",extension:n,previewClass:"iimage-file"}:$.inArray(t,markup.mimeType)>-1&&$.inArray(n,markup.extension)>-1?{type:"HTML",bgcolor:"#E0524D",extension:n,previewClass:"ihtml-file"}:$.inArray(t,codeFiles.mimeType)>-1&&$.inArray(n,codeFiles.extension)>-1?{type:"CODE",bgcolor:"#03A9F5",extension:n,previewClass:"icode-file"}:$.inArray(t,videoFiles.mimeType)>-1&&$.inArray(n,videoFiles.extension)>-1?{type:"VIDEO",bgcolor:"#5C6BC0",extension:n,previewClass:"ivideo-file"}:$.inArray(t,pdfFiles.mimeType)>-1&&$.inArray(n,pdfFiles.extension)>-1?{type:"PDF",bgcolor:"#ED2900",extension:n,previewClass:"ipdf-file"}:$.inArray(t,presentationFiles.mimeType)>-1&&$.inArray(n,presentationFiles.extension)>-1?{type:"PRESENTATION",bgcolor:"#FF7E45",extension:n,previewClass:"ipresentation-file"}:$.inArray(t,spreadSheetFiles.mimeType)>-1&&$.inArray(n,spreadSheetFiles.extension)>-1?{type:"SPREADSHEET",bgcolor:"#1CA663",extension:n,previewClass:"ispreadsheet-file"}:$.inArray(t,docFiles.mimeType)>-1&&$.inArray(n,docFiles.extension)>-1?{type:"DOC",bgcolor:"#4D8CF8",extension:n,previewClass:"idoc-file"}:{type:"UNKNOWN",bgcolor:"#78909C",extension:"unknown",previewClass:"iunknown-file"}}function getFileExtenstionFromName(e){return/(?:\.([^.]+))?$/.exec(e)[1]}function addEventListenerTo(e,t){e.push(t)}function removeGlobalEventListners(e){for(var t=0;t<e.length;t++)Lyte.removeEventListener(e[t])}function validateEmail(e){return/^(([^<>()[\]\\.,;:\s@"]+(\.[^<>()[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z0-9-]+\.)+[a-zA-Z]{2,}))$/.test(e)}function isValidCode(e){return 200===e||201===e}function sanitizeLink(e){return e.includes("://")&&!e.includes("javascript://")?e:"http://"+e}function getTextColor(e){if(isValidString(e)){var t,n,r;if(e.match(/#/))t=hexToRed(e),n=hexToGreen(e),r=hexToBlue(e);else{var o=e.substring(e.indexOf("(")+1,e.lastIndexOf(")")).split(/,\s*/);t=o[0],n=o[1],r=o[2]}return Math.round((299*parseInt(t)+587*parseInt(n)+114*parseInt(r))/1e3)>125?"#212121":"#ffffff"}return"#212121"}function hexToRed(e){return e=removeHash(e),parseInt(e.substring(0,2),16)}function hexToGreen(e){return e=removeHash(e),parseInt(e.substring(2,4),16)}function hexToBlue(e){return e=removeHash(e),parseInt(e.substring(4,6),16)}function removeHash(e){return"#"===e.charAt(0)?e.substring(1,7):e}function generateRandomHexColorCode(){var e=["#FFFFFF","#FAD154","#CFC4FF","#F7BFFF","#61D1FF","#85EBD9","#C4FFED","#DEF58F","#D9E8F0","#FFED7D","#FFD921","#FF9C00","#FA9959","#B3D9E6","#BAC28A","#D1EBB8","#D1D9C9","#FFDB70","#FFA8B3","#E3E3E3","#ABD1C9","#E8BA2B","#9CC2D6","#D4E0E3","#FFC27D","#E8B01C","#57C2FF","#BFD9C2","#82D9DE","#ABC29E","#F0C221","#301294","#2175FF","#2E3BA3","#0087D4","#00549E","#0096A8"];return e[Math.floor(Math.random()*e.length)]}function hexToRgb(e){e=e.replace(/^#?([a-f\d])([a-f\d])([a-f\d])$/i,function(e,t,n,r){return t+t+n+n+r+r});var t=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(e);return t?{r:parseInt(t[1],16),g:parseInt(t[2],16),b:parseInt(t[3],16)}:null}function convertToHEx(e){var t=parseInt(e[0]).toString(16);t=1===t.length?"0"+t:t;var n=parseInt(e[1]).toString(16);n=1===n.length?"0"+n:n;var r=parseInt(e[2]).toString(16);return"#"+t+n+(1===r.length?"0"+r:r)}function showDimmerForAlert(){var e=document.getElementById("dimmer-for-alert");e&&e.classList.add("show")}function hideDimmerForAlert(){var e=document.getElementById("dimmer-for-alert");e&&e.classList.remove("show")}function transitionEndSupport(){var e,t=document.createElement("div"),n={transition:"transitionend",OTransition:"otransitionend",MozTransition:"transitionend",WebkitTransition:"webkitTransitionEnd"};for(e in n)if(n.hasOwnProperty(e)&&void 0!==t.style[e])return n[e];return null}function displayToast(e){document.getElementById("toast-message-text").innerText=e;var t=document.getElementById("toast-message").offsetHeight+"px";document.getElementById("toast-message").style.marginTop="0px",setTimeout(function(){document.getElementById("toast-message").style.marginTop="-"+t},3e3)}function setFocusAtEnd(e){if(e.focus(),void 0!==window.getSelection&&void 0!==document.createRange){var t=document.createRange();t.selectNodeContents(e),t.collapse(!1);var n=window.getSelection();n.removeAllRanges(),n.addRange(t)}else if(void 0!==document.body.createTextRange){var r=document.body.createTextRange();r.moveToElementText(e),r.collapse(!1),r.select()}}function makeInputFieldFocus(e){document.querySelector(e).innerHTML="",document.querySelector(e).focus()}function calculateLocale(){const e=navigator.languages[0]||navigator.language||navigator.userLanguage;var t=["en-us","zh-cn","ja","ru-ru","ru"].includes(e.toLowerCase())?e:"en-us";return"ru"===t.toLowerCase()&&(t="ru-Ru"),t.toLowerCase()}function addClass(e,t){e.className=e.className+" "+t}function toHTML(e){var t=document.createElement("div");return t.innerHTML=e,t.firstChild}function openLinkInNewTab(e){var t=window.open();t.opener=null,t.location=e,t.target="_blank"}var operation,isCallback=!1;function showAlert(e,t,n,r,o,i,a){operation=n,isCallback=t;var s=document.getElementById("alert-box");s&&(s.className="alert-box-wrap center");var l=document.getElementById("alert-message");l&&(l.innerText=e);var c=document.getElementById("ok-button"),d=document.getElementById("cancel-button"),u=document.getElementById("proceed-button");isValidString(r)||(r=translate.options.okay),r&&!i?(c.classList.remove("hide"),c.innerText=r,c.style.color=o,d.classList.add("hide"),u.classList.add("hide")):(c.classList.add("hide"),d.classList.remove("hide"),d.innerText=r,d.style.color=o,u.classList.remove("hide"),u.innerText=i,u.style.color=a),showDimmerForAlert()}function cancelAlert(){document.getElementById("alert-box").className="alert-box-wrap moveup",hideDimmerForAlert(),isCallback&&Lyte.triggerEvent(operation,CONST.get("ALERT_ACTION_NEGATIVE")),resetAlertValue()}function okAlert(){document.getElementById("alert-box").className="alert-box-wrap movedown",hideDimmerForAlert(),isCallback&&Lyte.triggerEvent(operation,CONST.get("ALERT_ACTION_POSITIVE")),resetAlertValue()}function resetAlertValue(){operation=void 0,isCallback=!1}function resetAlertClass(){document.getElementById("alert-box").className="alert-box-wrap"}var translate={whatsNewMenu:{mobiles:"Mobiles",notebookForWeb:"Notebook For Web",notebookForMac:"Notebook For Mac",webClippers:"Web Clipper",resources:"Resources",features:"Features",multiTaskinIpad:"MultiTask in iPad Pro",safari:"Safari",chrome:"Chrome",firefox:"Firefox",faq:"FAQ",migrateFromEvernote:"Migrate From Evernote",signUp:"SIGN UP NOW"},recipe:{by:"by",source:"Source:",ingredients:"Ingredients",preparation:"Preparation",copyright:""},toastMessage:{DFSDownloadFailed:"Oops! Unable to download note card",enterValidMail:"Please enter valid email address",reportAbuseFailed:"Oops! Unable to report abuse",reportSuccess:"Abuse Report has been submitted successfully"},generalOption:{previewUnavailable:"Preview not available. Click here to Download",lastEdited:"Last Edited",reportAbuse:"Report Abuse"},publicShare:{defaultErrorTitle:"Sorry, there's no note here.",defaultErrorDescription:"Possible reasons: The URL may be incorrect or the note might have been removed.",noReaderContentFirstSen:"No Reader content available for this notecard.",noReaderContentSecondSen:"You can view the webpage in new tab",openLinkInNewTab:"Open link in New Tab"},contact:{firstName:"First Name",lastName:"Last Name",job:"Job",organization:"Organization",phone:"Phone",website:"Website",street:"Street",city:"City",state:"State",country:"Country",zip:"Zip",social:"Social",notes:"Notes",email:"Email"},options:{send:"Send",sending:"Sending",cancel:"Cancel",okay:"OK"},email:{from:"From",email:"Email",subject:"Subject",noSubjectAlert:"Do you want to send email without subject?"},reportAbuse:{hiThere:"Hi there",reportContent:"I need to file a complaint on the content published in one of your pages",thanks:"Thanks",subject:"Report abuse on notebook public note link"},loginPage:{header:"Let your thoughts bring your team together.",subHeader:"Increase your team productivity levels, and give your business the edge it needs with Notebook in Microsoft Teams.",signinWithZoho:"Sign in with Zoho",signinwithOffice:"Sign in with Office365",noteMessage:"If this window does not close in a few seconds, please close it manually and continue in the tab."}};